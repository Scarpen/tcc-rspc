<p id="notice"><%= notice %></p>

<h1>Lista de Pessoas</h1>

<table>
  <thead>
    <tr>
      <th></th>
      <th>Name</th>
      <th>E-mail</th>
      <th colspan="3">Ações</th>
    </tr>
  </thead>

  <tbody>
    <% @users.each do |user| %>
      <% if user.id != current_user.id %>
        <tr>
          <td><%= image_tag(user.avatar) %></td>
          <td><%= user.name %></td>
          <td><%= user.email %></td>
          <td><%= link_to 'Visualizar Perfil', user_path(id: user.id) %>

            <% if Friend.where(user_id: current_user.id, friend_id: user.id).first %>
              <% if Friend.where(user_id: current_user.id, friend_id: user.id).first.status == 'request' %>
                Solicitação realizada
                <%= link_to 'Cancelar' %>
              <% end %>
              <% if Friend.where(user_id: current_user.id, friend_id: user.id).first.status == 'pending' %>
              <%= link_to 'Aceitar' %>
              <%= link_to 'Recusar' %>
              <% end %>
            <%else%>
              <%= link_to 'Solicitar Amizade', friend_request_friends_path(user: user) %>
            <% end %>           
        </td>
        </tr>
      <% end %>
    <% end %>
  </tbody>
</table>



<br><br><br>

<div class="row">
  <!-- Not implemented on tutorial -->
  <div class="col-md-4">
    <div style="height: 300px; overflow-y: auto;">
      <div class="panel panel-default">
        <!-- Default panel contents -->
        <div class="panel-heading">Registered Users</div>

        <!-- Table -->
        <table class="table">
          <thead>
          <tr>
            <th>#</th>
            <th>email</th>
            <th></th>
          </tr>
          </thead>
          <tbody>
          <% @current_user.friends.each_with_index do |friend, index| %>
              <tr>
                <td><%= index +=1 %></td>
                <td><%= friend.friend.email %></td>
                <td>
                  <%= link_to "Send Message", "#", class: "btn btn-success btn-xs start-conversation",
                              "data-sid" => current_user.id, "data-rip" => friend.friend_id %>
                </td>
              </tr>
          <% end %>

          </tbody>
        </table>
      </div>

    </div>
    
    <h3>Your Conversations</h3>

      <div style="height: 400px; overflow-y: auto;">
        <% if @conversations.any? %>
            <ul class="media-list">
              <% @conversations.each do |conversation| %>
                  <li class="media">
                    <%= image_tag("http://placehold.it/50x50", class: "media-object pull-left") %>
                    <div class="media-body">
                      <%= link_to "", conversation_path(conversation), class: "conversation", "data-cid" => conversation.id %>
                          <h4 class="media-heading"><%= conversation_interlocutor(conversation).name%></h4>
                          <p><%= conversation.messages.last.nil? ? "No messages" : truncate(conversation.messages.last.body, length: 45) %></p>
                    </div>
                  </li>

              <% end %>
            </ul>
        <% else %>
            <p>You have no conversations. Click send message with any user to create one.</p>
        <% end %>
      </div>


  </div>

  <div class="col-md-4">

  </div>

</div>